\documentclass[12pt]{article}
\usepackage{amsmath,amsfonts,amssymb,graphicx,authblk}
\usepackage[font={footnotesize,singlespacing},labelfont=bf]{caption}
\usepackage{blkarray, bm} 
\usepackage{float,afterpage}
\usepackage[running,mathlines]{lineno}

\usepackage[verbose,letterpaper,tmargin=2.54cm,bmargin=2.54cm,lmargin=2.54cm,rmargin=2.54cm]{geometry}
\usepackage[authoryear,sort]{natbib}
\usepackage{hyperref}


%%%%%%%%%% FORMATTING 
\usepackage[compact,small]{titlesec}
\usepackage[moderate]{savetrees}
\usepackage[nodisplayskipstretch]{setspace} 

\usepackage{enumitem}
\setlist{topsep=.1em,itemsep=-0.2em,leftmargin=0.75cm}
\setlength{\parindent}{0.35in}

\renewcommand{\refname}{Literature Cited}
\renewcommand{\floatpagefraction}{0.9}
\renewcommand{\topfraction}{0.99}
\renewcommand{\textfraction}{0.05}

\clubpenalty = 10000
\widowpenalty = 10000
\sloppy 

%%%%%%%%%% FONT 
% \usepackage[sc]{mathpazo} %Like Palatino with extensive math support
% \usepackage{mathptmx} %Like Palatino with extensive math support
\usepackage[scale=1.03]{newtxtext,newtxmath} 


\usepackage{ifpdf}
\ifpdf
\DeclareGraphicsExtensions{.pdf,.png,.jpg}
\usepackage{epstopdf}
\else
\DeclareGraphicsExtensions{.eps}
\fi


% Coloring of R code listings
\usepackage[formats]{listings}
\usepackage{color}
\definecolor{mygreen}{rgb}{0.1,0.5,0.1}
\definecolor{mygray}{rgb}{0.5,0.5,0.5}
\definecolor{mymauve}{rgb}{0.58,0,0.82}
\definecolor{mygrey}{rgb}{0.3,0.3,0.1}
\lstset{
language=R,
otherkeywords={data.frame},
basicstyle=\normalsize\ttfamily, 
commentstyle=\normalsize\ttfamily,
keywordstyle=\normalsize\ttfamily,
stringstyle=\color{mymauve}, 
commentstyle=\color{mygreen},
keywordstyle=\color{blue},
showstringspaces=false, xleftmargin=2.5ex,
columns=flexible,
literate={~}{{$\sim \; \; $}}1,
alsodigit={\.,\_},
deletekeywords={on,by,data,R,Q,mean,var,sd,log,family,na,options,q,weights,effects,matrix,nrow,ncol,wt,fix,distance},
}
\lstset{escapeinside={(*}{*)}} 

\lstdefineformat{Rpretty}{
	; = \space,
	\, = [\ \,\]]\string\space,
	<- = [\ ]\space\string\space,
	\= = [\ ]\space\string\space}


\newcommand{\be}{\begin{equation}}
\newcommand{\ee}{\end{equation}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
%%% Just for commenting
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[dvipsnames]{xcolor}
\newcommand{\comment}{\textcolor{blue}}
\newcommand{\new}{\textcolor{red}}
\newcommand{\red}{\textcolor{red}}

\newcommand{\tom}[2]{{\color{red}{#1}}\footnote{\textit{\color{red}{#2}}}}
\newcommand{\steve}[2]{{\color{blue}{#1}}\footnote{\textit{\color{blue}{#2}}}}



\begin{document}

\begin{spacing}{1.35} 
\linenumbers
\centerline{\Large{\textbf{Supporting Information}}}

\section{The Jones-Pewsey sinh-arcsinh distributions} 
\label{sec:SHASHdist} 
\citet{jones-pewsey-2009} introduced a tractable generalization of the Normal distribution with two 
additional parameters determining asymmetry (skewness), and tail weight (kurtosis) which can be  
lighter or heavier than the Gaussian. It is defined through transformation of the
Normal distribution using the hyperbolic sine function (sinh) and its inverse (asinh), 
as follows. The base distribution $f_{\epsilon,\delta}$  is the 
probability density of the random variable $X_{\epsilon,\delta}$ where  
\be
Z = \sinh (\delta \; \mbox{asinh}(X_{\epsilon,\delta}) - \epsilon)
\label{eqn:JP1}
\ee
and $Z$ has a Normal(0,1) distribution. Equivalently, 
\be
X_{\epsilon,\delta} = \sinh \left( \delta^{-1} \big[\mbox{asinh}(Z) + \epsilon \big] \right), \quad Z \sim \mathcal{N}(0,1).
\label{eqn:JP2}
\ee
Parameters $\delta=1, \; \epsilon=0$ give the Normal(0,1) distribution. Skewness has the sign of $\epsilon$, and
$\delta > 0$ controls tail weight, with heavier than Gaussian tails for $\delta<1$ and lighter than Gaussian tails for $\delta > 1$. 
The density function for $X_{\epsilon,\delta}$ is given by \citet[][eqn. 2]{jones-pewsey-2009}, 
\be
\begin{aligned}
f_{ \epsilon,\delta}(x) & = C(x) \exp\{-S(x)^2/2\} \{2\pi(1+x^2)\}^{-1/2}  \\
 \mbox{ where }  S(x) & =  \mbox{sinh}(\delta \mbox{ asinh}(x)- \epsilon), \\
C(x)  & =  \sqrt{1 + S(x)^2} = \mbox{cosh}(\delta \mbox{ asinh}(x)- \epsilon).
\end{aligned} 
\ee
The attainable combinations of skewness and kurtosis are 
very broad compared to other four-parameter families, and come very close to the theoretical limit of
kurtosis as a function of skewness \citep[][Fig.  2]{jones-pewsey-2009}. 
Additionally, eqn. \eqref{eqn:JP2} makes it straightforward to generate random numbers and to compute 
the probability density, cumulative distribution, and quantile functions. 
There are also analytic formulas for the first four moments \citep[][p. 764]{jones-pewsey-2009}.

\citet{jones-pewsey-2009} defined a four-parameter distribution with location 
parameter $\mu$ and scale parameter $\sigma$ as the distribution of $\mu + \sigma X_{\epsilon, \delta}$, 
which has density function 
\be
f_{\mu, \sigma,  \epsilon,\delta}(x)  = \sigma^{-1}f_{ \epsilon,\delta}( \sigma^{-1}(x - \mu)). 
\label{eqn:JP4} 
\ee
Terminology on this distribution has become somewhat confused. in the \textbf{mgcv} R package 
it is called \texttt{shash}, while in the \textbf{gamlss} package it is called \texttt{SHASHo2} 
and \texttt{SHASH} is a differently parameterized form of the distribution. To get around 
this confusion we will refer to \eqref{eqn:JP4} as the JP4 distribution (``Jones-Pewsey 4 parameter''), 
and refer to \eqref{eqn:JP2} as JP2. 
% with density functions $f_{JP4}$ and $f_{JP2}$ respectively.  

As is the case for most four-parameter distributions, $\mu$ is not the mean of the JP4 distribution, 
$\sigma$ is not the standard deviation, $\epsilon$ is not the skew and $\delta$ is not the kurtosis. 
We therefore define a new four-parameter distribution family, JPS, by shifting and scaling JP2
so that the location parameter $\mu$ is the mean, and the scale parameter $\sigma$ is the standard deviation. 
This form can then be used in custom likelihood functions that ``import'' the fitted mean 
and standard deviation from a Gaussian pilot model, in the same way that the skewed $t$ distribution was used in our 
lady orchid case study. 

Let $m(\epsilon,\delta)$ and $s(\epsilon, \delta)$ denote the mean and standard deviation of the JP2 distribution. 
Then define 
\be  
X_{\theta} = \mu \; + \; \sigma \left(\frac{X_{\epsilon,\delta} - m(\epsilon,\delta)}{s(\epsilon,\delta)}\right).
\ee
The right-hand term in parentheses has mean 0 and variance 1, so 
$X_{\theta}$ has mean $\mu$ and variance $\sigma^2$, with $\epsilon$ and $\delta$ controlling skewness
and tail weight as in JP2. Omitting some algebra, $X_{\theta}$ has cumulative distribution function 
\be
Pr(X_{\theta} \le x)  = Pr\left(X_{\epsilon,\delta} \le  m(\epsilon,\delta) + \frac{s(\epsilon,\delta)}{\sigma}(x - \mu)\right).
\ee
Differentiating both sides with respect to $x$, the probability distribution function for $X_{\theta}$ is 
\be
f_{JPS}(x \vert \mu, \sigma, \epsilon, \delta) =  \frac{s(\epsilon,\delta)}{\sigma} 
f_{ \epsilon,\delta}\left(m(\epsilon,\delta) + \frac{s(\epsilon,\delta)}{\sigma}(x - \mu) \right) 
\ee
Code for the JP2 and JPS distributions with the usual \texttt{d,p,q,r} functions are provided 
in our code archive script \texttt{JPfuns.R}. 

It eventually transpired that none of our case studies involved fitting a SHASH distribution through a ``custom'' likelihood 
function (though this was transiently the case). But for the sake of possible future applications, we record here some 
advice for doing so based on our experience. 

Eqn. \eqref{eqn:JP2} shows that the JP2 distribution depends on $\epsilon$ only through the ratio $\epsilon/\delta$. We have found
that this property can be problematic for parameter estimation, because of a ridge in the likelihood surface with constant  
$\epsilon/\delta$. Another problem is that when $\delta$ is large, changes in $\epsilon$ have little effect. 

To avoid those problems, we recommend writing likelihood functions in terms of 
skewness and kurtosis parameters $\lambda$ and $\tau$, defined by $\delta = e^{-\tau}, \; \epsilon =  \delta \lambda$ in the 
JPS distribution. We will refer to this as the JPR distribution, with probability density 
\be
f_{JPR}(x \vert \mu, \sigma, \lambda, \tau) = f_{JPS}(x \vert \mu, \sigma, e^{-\tau}\lambda,  e^{\tau}). 
\ee
$\lambda$ can take any real value, and the distribution's skew has the same sign as $\lambda$. 
$\tau$ also can take any real value, with negative values giving thinner than Gaussian tails 
and positive values giving fatter than Gaussian tails. 

It is still the case that skewness and kurtosis jointly depend on $\tau$ and $\lambda$, but the
``crosstalk'' is weaker than that between $\delta$ and $\epsilon$. 
As a result, we found that likelihood optimization is numerically more stable when the likelihood function is 
written as a function of $\tau$ and $\lambda$ rather than $\delta$ and $\epsilon$, in addition to $\mu$ and $\sigma$.  

\begin{thebibliography}{62}
\providecommand{\natexlab}[1]{#1}

\bibitem[{Jones \& Pewsey(2009)}]{jones-pewsey-2009}
Jones, M. \& Pewsey, A. (2009) Sinh-arcsinh distributions. \emph{Biometrika}
  \textbf{96}, 761 -- 780.

\end{thebibliography}

\end{spacing}
\end{document}